# Coursiv 分阶段迭代方案

**版本**: V3.0
**日期**: 2026-01-12
**状态**: 待确认

---

## 一、迭代原则

1. **分阶段实施** - 将所有改进分为 3 个独立阶段
2. **测试驱动** - 每阶段先编写 E2E 测试用例，再实施功能
3. **零 Bug 交付** - 每阶段必须通过所有测试才能进入下一阶段
4. **与原站对比** - 所有测试基于与 Coursiv.io 的行为对比

---

## 二、阶段划分

### 阶段概览

| 阶段 | 名称 | 范围 | 预计时间 |
|------|------|------|----------|
| **阶段 1** | Quiz 引导流程重构 | Quiz 流程与原站完全一致 | 2.5 小时 |
| **阶段 2** | 注册与跳转逻辑修复 | 注册后跳转 + 课程 ID + 按钮响应 | 2 小时 |
| **阶段 3** | 课程交互与 Coming Soon | 蛇形路径交互 + Coming Soon 页面 | 2 小时 |

**总计**: 6.5 小时

---

## 三、阶段 1：Quiz 引导流程重构

### 3.1 目标

使 Quiz 引导流程与原站 Coursiv.io 逻辑完全一致。

### 3.2 改动清单

| # | 改动项 | 当前状态 | 目标状态 |
|---|--------|----------|----------|
| 1 | 第一步问题 | "Who are you?" | "How would you describe yourself?" |
| 2 | 第一步选项数 | 5 个（带 Emoji） | 2 个（带真人照片） |
| 3 | 第一步选项内容 | Employee/Freelancer/Student/... | "I work for a company" / "I work for myself" |
| 4 | 标题 | 无 | "28-DAY AI CHALLENGE" |
| 5 | 进度显示 | "Step X of 22" 中间 | "X / 20" 右上角 |
| 6 | 总步骤数 | 22 步 | 20 步 |
| 7 | 底部法律链接 | 无 | Terms of Service / Privacy Policy |
| 8 | 中间鼓励页 | 无 | "Worry no more!" 等鼓励页面 |

### 3.3 E2E 测试用例

#### TC1.1: 第一步显示验证
```
测试名称: Quiz 第一步应显示二选一身份选择
前置条件: 用户未登录
测试步骤:
  1. 访问主页 https://localhost:3000
  2. 点击 "Get Started" 按钮
预期结果:
  - 页面显示 "28-DAY AI CHALLENGE" 标题
  - 问题文本为 "How would you describe yourself?"
  - 显示 2 个选项卡片
  - 选项 1: "I work for a company" + 真人照片
  - 选项 2: "I work for myself" + 真人照片
  - 无进度指示器（第一步不显示）
```

#### TC1.2: 社交证明页验证
```
测试名称: 选择身份后应显示社交证明页
前置条件: 已完成 TC1.1
测试步骤:
  1. 点击 "I work for a company" 选项
预期结果:
  - 页面显示 "More than X people joined"
  - 显示 CONTINUE 按钮
  - 无进度指示器
```

#### TC1.3: 进度显示验证
```
测试名称: 进入问卷后应在右上角显示进度
前置条件: 已完成 TC1.2
测试步骤:
  1. 点击 CONTINUE 按钮
预期结果:
  - 进入年龄选择页面
  - 右上角显示 "1 / 20"
  - 问题为 "What is your age?"
  - 显示 4 个年龄选项
```

#### TC1.4: 鼓励页验证
```
测试名称: 在适当位置应显示鼓励页面
前置条件: 已完成前 5 个问题
测试步骤:
  1. 完成第 5 个问题
预期结果:
  - 显示鼓励页面
  - 标题为 "Worry no more!" 或类似鼓励文案
  - 显示 CONTINUE 按钮
  - 无进度指示器
```

#### TC1.5: 底部法律链接验证
```
测试名称: Quiz 页面底部应显示法律链接
前置条件: 在任意 Quiz 页面
测试步骤:
  1. 查看页面底部
预期结果:
  - 显示 "Terms of Service" 链接
  - 显示 "Privacy Policy" 链接
  - 链接可点击
```

#### TC1.6: 总步骤数验证
```
测试名称: Quiz 总步骤应为 20 步
前置条件: 用户在 Quiz 流程中
测试步骤:
  1. 完成所有问题直到最后一步
预期结果:
  - 最后一个带进度的问题显示 "20 / 20"
  - 之后进入结果/注册页面
```

### 3.4 验收标准

- [ ] TC1.1 通过
- [ ] TC1.2 通过
- [ ] TC1.3 通过
- [ ] TC1.4 通过
- [ ] TC1.5 通过
- [ ] TC1.6 通过
- [ ] 无 TypeScript 编译错误
- [ ] 无控制台错误

---

## 四、阶段 2：注册与跳转逻辑修复

### 4.1 目标

修复注册后跳转逻辑 Bug，确保用户不会重复进入引导流程；修复课程 ID 不匹配和按钮无响应问题。

### 4.2 改动清单

| # | 改动项 | 当前状态 | 目标状态 |
|---|--------|----------|----------|
| 1 | 注册后跳转 | 有时重复进入 Quiz | 直接进入 Dashboard |
| 2 | 已注册用户访问 /quiz | 允许进入 | 重定向到 Dashboard |
| 3 | 课程 ID | `dalle` | `dall-e` |
| 4 | "Get Certified Today" | 无响应 | 跳转到 /quiz/1 |
| 5 | "Join Now" | 无响应 | 跳转到 /dashboard/challenges |
| 6 | Blog 链接 | href="#" | href="/blog" |
| 7 | Support 链接 | href="#" | href="/support" |

### 4.3 E2E 测试用例

#### TC2.1: 注册后跳转验证
```
测试名称: 完成注册后应直接进入 Dashboard
前置条件: 新用户完成 Quiz 流程
测试步骤:
  1. 完成 Quiz 所有步骤
  2. 完成注册（邮箱/密码）
预期结果:
  - 自动跳转到 /dashboard/guides
  - 不再显示 Quiz 页面
  - 页面显示课程列表
```

#### TC2.2: 已注册用户 Quiz 重定向验证
```
测试名称: 已完成引导的用户访问 /quiz 应重定向
前置条件: 用户已登录且已完成引导
测试步骤:
  1. 直接访问 /quiz/1
预期结果:
  - 自动重定向到 /dashboard/guides
  - 不显示 Quiz 页面
```

#### TC2.3: 页面刷新后状态保持验证
```
测试名称: 刷新页面后应保持在 Dashboard
前置条件: 用户已登录且在 Dashboard
测试步骤:
  1. 刷新页面（F5）
预期结果:
  - 保持在 Dashboard
  - 不跳转到 Quiz
  - 用户状态正常
```

#### TC2.4: DALL-E 课程访问验证
```
测试名称: 从 Dashboard 点击 DALL-E 课程应正常访问
前置条件: 用户已登录且在 Dashboard
测试步骤:
  1. 访问 /dashboard/guides
  2. 点击 DALL-E 课程卡片
预期结果:
  - 跳转到 /course/dall-e
  - 显示 DALL-E 课程详情
  - 显示课程模块列表
```

#### TC2.5: "Get Certified Today" 按钮验证
```
测试名称: 点击 "Get Certified Today" 应跳转到 Quiz
前置条件: 用户未登录，在主页
测试步骤:
  1. 滚动到 "Get Certified Today" 按钮位置
  2. 点击按钮
预期结果:
  - 跳转到 /quiz/1
  - 显示 Quiz 第一步
```

#### TC2.6: "Join Now" 按钮验证
```
测试名称: 点击 "Join Now" 应跳转到 Challenge
前置条件: 用户在主页
测试步骤:
  1. 滚动到 Challenge 部分
  2. 点击 "Join Now" 按钮
预期结果:
  - 跳转到 /dashboard/challenges
  - 显示 Challenge 页面
```

#### TC2.7: 导航链接验证
```
测试名称: 导航栏 Blog 和 Support 链接应可用
前置条件: 用户在任意页面
测试步骤:
  1. 点击导航栏 "Blog" 链接
  2. 返回，点击 "Support Center" 链接
预期结果:
  - Blog 链接跳转到 /blog
  - Support 链接跳转到 /support
  - 两个页面都正常显示
```

### 4.4 验收标准

- [ ] TC2.1 通过
- [ ] TC2.2 通过
- [ ] TC2.3 通过
- [ ] TC2.4 通过
- [ ] TC2.5 通过
- [ ] TC2.6 通过
- [ ] TC2.7 通过
- [ ] 无 TypeScript 编译错误
- [ ] 无控制台错误

---

## 五、阶段 3：课程交互与 Coming Soon

### 5.1 目标

修复课程蛇形路径交互问题，创建 Coming Soon 页面，替换所有 "建设中" 文案。

### 5.2 改动清单

| # | 改动项 | 当前状态 | 目标状态 |
|---|--------|----------|----------|
| 1 | 锁定模块点击 | 无反馈 | 显示提示信息 |
| 2 | Continue 按钮 | 被遮挡 | 正常可点击 |
| 3 | "You're here" 标签 | 无 | 当前模块显示标签 |
| 4 | Blog 页面 | 无 | Coming Soon 页面 |
| 5 | Support 页面 | 无 | Coming Soon 页面 |
| 6 | "建设中" 文案 | 中文 | "Coming Soon" 英文 |

### 5.3 E2E 测试用例

#### TC3.1: 锁定模块点击反馈验证
```
测试名称: 点击锁定模块应显示提示
前置条件: 用户在课程详情页，有锁定模块
测试步骤:
  1. 访问 /course/chatgpt
  2. 点击一个锁定的模块（如第 3 个模块）
预期结果:
  - 显示提示信息 "Complete previous modules to unlock"
  - 不弹出模块详情
  - 模块保持锁定状态
```

#### TC3.2: Continue 按钮可点击验证
```
测试名称: 课程内容页 Continue 按钮应正常工作
前置条件: 用户在课程内容页
测试步骤:
  1. 访问 /lesson/chatgpt/chatgpt-1-1
  2. 点击 Continue 按钮
预期结果:
  - 页面内容切换到下一页
  - 进度从 "1/3" 变为 "2/3"
  - 按钮不被任何元素遮挡
```

#### TC3.3: "You're here" 标签验证
```
测试名称: 当前学习模块应显示 "You're here" 标签
前置条件: 用户有学习进度
测试步骤:
  1. 访问 /course/chatgpt
  2. 查看当前学习模块
预期结果:
  - 当前模块上方显示 "You're here" 标签
  - 标签样式醒目（紫色背景）
  - 有向下的小箭头指向模块
```

#### TC3.4: Blog Coming Soon 页面验证
```
测试名称: Blog 页面应显示 Coming Soon
前置条件: 无
测试步骤:
  1. 访问 /blog
预期结果:
  - 显示 Coming Soon 页面
  - 标题为 "Blog"
  - 有返回主页按钮
  - 页面样式美观
```

#### TC3.5: Support Coming Soon 页面验证
```
测试名称: Support 页面应显示 Coming Soon
前置条件: 无
测试步骤:
  1. 访问 /support
预期结果:
  - 显示 Coming Soon 页面
  - 标题为 "Support Center"
  - 有返回主页按钮
  - 页面样式美观
```

#### TC3.6: "建设中" 文案替换验证
```
测试名称: 所有页面不应出现 "建设中" 中文
前置条件: 无
测试步骤:
  1. 访问所有主要页面
  2. 搜索 "建设中" 文本
预期结果:
  - 所有页面无 "建设中" 文本
  - 相应位置显示 "Coming Soon"
```

### 5.4 验收标准

- [ ] TC3.1 通过
- [ ] TC3.2 通过
- [ ] TC3.3 通过
- [ ] TC3.4 通过
- [ ] TC3.5 通过
- [ ] TC3.6 通过
- [ ] 无 TypeScript 编译错误
- [ ] 无控制台错误

---

## 六、测试执行流程

### 6.1 每阶段测试流程

```
┌─────────────────────────────────────────────────────────┐
│                    阶段开始                              │
├─────────────────────────────────────────────────────────┤
│  1. 编写/更新 E2E 测试用例（Vitest + Playwright）        │
│  2. 运行测试，确认当前状态（预期失败）                    │
│  3. 实施功能改动                                         │
│  4. 运行测试，验证改动                                   │
│  5. 如有失败，修复并重新测试                             │
│  6. 所有测试通过后，进行手动 E2E 验证                    │
│  7. 与原站 Coursiv.io 对比验证                           │
│  8. 保存检查点                                           │
│  9. 进入下一阶段                                         │
└─────────────────────────────────────────────────────────┘
```

### 6.2 测试文件结构

```
client/src/__tests__/
├── e2e/
│   ├── quiz-flow.test.ts      # 阶段 1 测试
│   ├── auth-redirect.test.ts  # 阶段 2 测试
│   └── course-interaction.test.ts  # 阶段 3 测试
├── unit/
│   ├── QuizContent.test.tsx
│   ├── Dashboard.test.tsx
│   └── CourseDetail.test.tsx
```

### 6.3 测试命令

```bash
# 运行所有测试
pnpm test

# 运行特定阶段测试
pnpm test quiz-flow
pnpm test auth-redirect
pnpm test course-interaction

# 运行 E2E 测试
pnpm test:e2e
```

---

## 七、实施时间表

| 阶段 | 任务 | 时间 | 验收 |
|------|------|------|------|
| **阶段 1** | Quiz 引导流程重构 | 2.5 小时 | TC1.1-TC1.6 全部通过 |
| | - 编写测试用例 | 30 分钟 | |
| | - 实施改动 | 1.5 小时 | |
| | - 测试验证 | 30 分钟 | |
| **阶段 2** | 注册与跳转逻辑修复 | 2 小时 | TC2.1-TC2.7 全部通过 |
| | - 编写测试用例 | 20 分钟 | |
| | - 实施改动 | 1 小时 | |
| | - 测试验证 | 40 分钟 | |
| **阶段 3** | 课程交互与 Coming Soon | 2 小时 | TC3.1-TC3.6 全部通过 |
| | - 编写测试用例 | 20 分钟 | |
| | - 实施改动 | 1 小时 | |
| | - 测试验证 | 40 分钟 | |
| **总计** | | **6.5 小时** | 19 个测试用例全部通过 |

---

## 八、风险与缓解

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| Quiz 步骤调整影响现有用户数据 | 中 | 保持数据库兼容，只改前端 |
| 真人照片版权问题 | 低 | 使用免费图库或 AI 生成 |
| 测试环境与生产环境差异 | 低 | 使用相同配置 |

---

## 九、确认清单

### 阶段划分确认
- [ ] 同意分为 3 个阶段实施
- [ ] 同意每阶段必须通过所有测试才能进入下一阶段
- [ ] 同意 6.5 小时总时间预算

### 测试用例确认
- [ ] 阶段 1 测试用例（6 个）覆盖完整
- [ ] 阶段 2 测试用例（7 个）覆盖完整
- [ ] 阶段 3 测试用例（6 个）覆盖完整

### 功能范围确认
- [ ] Quiz 流程与原站一致
- [ ] 注册后跳转逻辑修复
- [ ] 课程交互问题修复
- [ ] Coming Soon 页面创建
- [ ] "建设中" 改为 "Coming Soon"

### 不包含的功能确认
- [ ] AI Tools 完整实现（用 Coming Soon）
- [ ] 音频播放功能
- [ ] Blog 完整实现（用 Coming Soon）

---

**请确认以上方案，确认后我将按阶段开始实施。**
